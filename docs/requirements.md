# mdJournal 要求仕様書

## 1. 概要

### 1.1 目的
本ドキュメントは、Markdown形式で管理している日報データをグラフィカルに表示・編集するためのWebダッシュボードアプリケーション「mdJournal」の要求仕様を定義する。

### 1.2 背景
業務日報（計画・実績・プロジェクト情報・TODO）をMarkdownファイルで管理している。データ形式はMarkdownのまま維持しつつ、視覚的な管理インターフェースを提供することで、業務効率の向上を図る。

### 1.3 スコープ
- ローカル環境で動作するWebアプリケーション
- npxコマンドによる簡易起動
- 日報データの閲覧・編集機能
- 外部システムとの連携機能
- TypeScriptによるユーザー拡張機能

---

## 2. システム構成

### 2.1 技術スタック

| レイヤー | 技術 |
|---------|------|
| フロントエンド | React 18+ |
| UIフレームワーク | Ant Design 5.x |
| サーバーサイド | Express.js (Node.js) |
| データ形式 | Markdown / YAML |
| 状態管理 | React Context / Zustand |
| HTTPクライアント | Axios |
| Markdownパーサー | unified / remark |
| 拡張機能 | TypeScript |

### 2.2 配布形態

mdJournalはnpmパッケージとして配布し、`npx`コマンドで起動する。

```bash
# サンプルデータで起動
npx mdjournal

# 設定ファイルを指定して起動
npx mdjournal ./mdjournal.config.yaml

# ポートを指定して起動
npx mdjournal -p 8080
```

### 2.3 CLIツール

ダッシュボードサーバーの起動以外にも、以下のCLIコマンドを提供する。

#### バリデーション（フォーマット検証）

日報ファイルが仕様に準拠しているか検証する。

```bash
# ディレクトリ内の全.mdファイルを検証
npx mdjournal validate ./data

# 厳格モード（警告もエラーとして扱う）
npx mdjournal validate ./data --strict

# JSON形式で出力（CI/CD連携用）
npx mdjournal validate ./data --json
```

#### 統計情報（frontmatter）再集計

日報ファイルにfrontmatter（統計情報）を付与または再集計する。

```bash
# ディレクトリ内の全.mdファイルにfrontmatterを付与・更新
npx mdjournal stats ./data

# 変更内容のプレビュー（実際には更新しない）
npx mdjournal stats ./data --dry-run

# バリデーションを事前実行（エラーがあるファイルはスキップ）
npx mdjournal stats ./data --validate
```

### 2.4 アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                    Frontend (React + Ant Design)            │
├─────────────────────────────────────────────────────────────┤
│  Dashboard  │  Calendar  │  Timeline  │  TODO  │  Settings │
└──────────────────────────┬──────────────────────────────────┘
                           │ REST API
┌──────────────────────────┴──────────────────────────────────┐
│                    Backend (Express.js)                      │
├─────────────────────────────────────────────────────────────┤
│  Markdown Parser  │  File Manager  │  Extension Loader      │
├─────────────────────────────────────────────────────────────┤
│  Built-in Integrations (Slack, Git, GCal)                   │
└──────────────────────────┬──────────────────────────────────┘
                           │
┌──────────────────────────┴──────────────────────────────────┐
│                      Data Layer                              │
├─────────────────────────────────────────────────────────────┤
│  Daily Reports  │  Config (YAML)  │  User Extensions (TS)   │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. データ構造

### 3.1 ユーザーデータリポジトリ構成

ユーザーは個人のデータリポジトリを作成し、日報データをGitで管理する。

```
my-journals/                       # ユーザー個人のデータリポジトリ
├── data/                          # 日報ファイル（Git管理）
│   └── YYYY/MM/
│       └── YYYY-MM-DD.md
├── config/                        # 設定ファイル
│   ├── projects.yaml             # プロジェクトマスタ
│   └── routines.yaml             # ルーチン定義
├── extensions/                    # ユーザー拡張機能（TypeScript）
│   ├── tsconfig.json
│   ├── package.json
│   └── my-extension.ts           # カスタム連携等
├── mdjournal.config.yaml          # ルート設定ファイル
├── .env                           # 環境変数（APIキー等）
└── .gitignore                     # .envを除外
```

### 3.2 パッケージ内サンプルデータ

```
mdjournal/
├── client/                     # フロントエンド（React）
├── server/                     # バックエンド（Express.js）
├── docs/                       # ドキュメント
└── sample/                     # サンプルデータ（動作確認用）
    ├── mdjournal.config.yaml   # ルート設定ファイル
    ├── config/
    │   ├── projects.yaml
    │   └── routines.yaml
    └── reports/
        └── 2025/12/
            └── 2025-12-18.md
```

### 3.3 日報ファイル形式 (Markdown)

日報ファイルはYAML frontmatter + Markdown本文で構成される。
frontmatterには統計情報が含まれ、カレンダー表示時の高速な集計を可能にする。

```markdown
---
planHours: 8.0
resultHours: 7.5
todoCount: 5
todoCompleted: 2
todoInProgress: 1
projectHours:
  P99: 2.5
  P34: 3.0
updatedAt: 2025-12-18T17:30:00+09:00
---
# [日報] {名前} {日付}

## [PLAN]
* {開始時刻} [{プロジェクトコード}] {タスク名}[^meta1]
* {開始時刻} [{プロジェクトコード}] {タスク名}
* {終了時刻}

## [RESULT]
* {開始時刻} [{プロジェクトコード}] {タスク名}
* {開始時刻} [{プロジェクトコード}] {タスク名}
* {終了時刻}

## [TODO]

### {プロジェクトコード}
- [ ] @{期限} !!! {タスク名}
  {詳細説明（インデント2スペース）}
- [x] {完了タスク名}
- [*] !! {進行中タスク名}
- [-] {保留タスク名}

## [NOTE]
{自由記述メモ}

[^meta1]: {"priority": "high", "meeting_url": "https://..."}
```

**Frontmatter（統計情報）**:
サーバーがMarkdown保存時に自動計算し、frontmatterとしてファイル先頭に追加する。
カレンダーAPIはfrontmatterのみを読み取ることで、高速な集計が可能。

| フィールド | 説明 |
|-----------|------|
| `planHours` | 計画時間合計（時間） |
| `resultHours` | 実績時間合計（時間） |
| `todoCount` | TODO総数 |
| `todoCompleted` | 完了TODO数 |
| `todoInProgress` | 進行中TODO数 |
| `projectHours` | プロジェクト別実績時間 |
| `updatedAt` | 最終更新日時 |

**時間形式のポイント**:
- 各タスクは開始時刻のみを記載
- タスクの終了時刻 = 次のタスクの開始時刻
- 最後の行に終了時刻のみを記載してセクションを終了（休憩スロット）
- 途中に `* HH:MM` のみの行がある場合は休憩として扱う

**タイムライン表示の時間範囲**:
- デフォルト: 08:00〜20:00
- 予定に応じて自動拡張（0:00〜36:00まで対応）
- 24時を超える時刻も存在（例: 30:00 = 翌日6:00）
- 1時間あたりの高さは固定ピクセル（設定で変更可能）

#### TODOステータス記号
| 記号 | 状態 | UIアイコン | 説明 |
|------|------|-----------|------|
| `[ ]` | 未着手 | □（空の四角） | タスク未開始 |
| `[*]` | 進行中 | ▷（再生ボタン） | 作業中 |
| `[x]` or `[X]` | 完了 | ☑（チェック済み） | タスク完了 |
| `[-]` | 保留 | ⏸（一時停止） | 一時停止中 |

**ステータスサイクル**: チェックボックスクリックで順次切り替え
`未着手 → 進行中 → 完了 → 保留 → 未着手`

#### TODO優先度記号
| 記号 | 優先度 | UIバッジ |
|------|--------|---------|
| `!!!` | 高 | 赤バッジ |
| `!!` | 中 | オレンジバッジ |
| `!` | 低 | 青バッジ |

#### TODO形式の詳細
- プロジェクト別に`### {プロジェクトコード}`でグループ化
- 期日: `@YYYY-MM-DD`（タスク名の前に配置）
- 優先度: `!!!`/`!!`/`!`（タスク名の前に配置）
- 詳細説明: 2スペースインデントで複数行記述可能

### 3.4 設定ファイル形式

#### projects.yaml（プロジェクトマスタ）

```yaml
projects:
  - code: "P99"
    name: "社内業務"
    color: "#52c41a"
    category: "internal"
    active: true
    
  - code: "P34"
    name: "クライアントA"
    color: "#1890ff"
    category: "client"
    client: "A社"
    active: true

categories:
  - id: "internal"
    name: "社内業務"
  - id: "client"
    name: "クライアント業務"
  - id: "personal"
    name: "個人"
```

#### routines.yaml（ルーチン定義）

```yaml
routines:
  weekly:
    monday:
      - time: "08:00"
        project: "P99"
        task: "タスク確認・整理、日報返信"
        duration: 60
      - time: "09:00"
        project: "P99"
        task: "定例会議"
        duration: 30
    
    tuesday:
      - time: "08:00"
        project: "P99"
        task: "タスク確認・整理、日報返信"
        duration: 60

  monthly:
    end_of_month:
      - project: "P99"
        task: "面談スケジュール調整"
        category: "todo"
    
    start_of_month:
      - project: "P99"
        task: "経費精算申請"
        category: "todo"

  quarterly:
    - months: [3, 6, 9, 12]
      tasks:
        - project: "P99"
          task: "契約更新確認"

  yearly:
    - month: 11
      day: 10
      project: "P99"
      task: "クラウドサービス契約更新"
```

---

## 4. 機能要件

### 4.1 ダッシュボード

#### 4.1.1 デフォルトレイアウト
デフォルトのダッシュボードレイアウトは以下の構成とする：

```
┌────────────────────────────────────────────────────────────────┐
│  Header: ロゴ | 日付選択 | 連携状態 | 取り込み | Commit&Push | User │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌──────────────┐ ┌──────────────┐ ┌────────────────────────┐ │
│  │              │ │              │ │                        │ │
│  │  タイムライン │ │     TODO     │ │      カレンダー        │ │
│  │  (計画/実績)  │ │  (PJ別表示)  │ │      (月表示)          │ │
│  │              │ │              │ ├────────────────────────┤ │
│  │              │ │              │ │                        │ │
│  │              │ │              │ │     プロジェクト        │ │
│  │              │ │              │ │      (一覧)            │ │
│  └──────────────┘ └──────────────┘ └────────────────────────┘ │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

- タイムラインとTODOの間はドラッグで幅を変更可能
- 各パネルは個別にスクロール可能
- ルーチン取り込みはヘッダーの「取り込み」ボタンからアクセス

#### 4.1.2 レイアウトカスタマイズ
- **FR-DASH-001**: セクションのドラッグ&ドロップによる配置変更
- **FR-DASH-002**: タイムラインとTODO間のリサイズ機能
- **FR-DASH-003**: レイアウト設定のYAML保存・読み込み
- **FR-DASH-004**: プリセットレイアウトの選択機能
- **FR-DASH-005**: セクションの表示/非表示切り替え

#### 4.1.3 テーマ設定
- **FR-DASH-006**: プライマリカラーのカスタマイズ

※ダークモードは将来バージョンで対応予定

### 4.2 カレンダービュー

#### 4.2.1 表示機能
- **FR-CAL-001**: 月表示モード（デフォルト）
- **FR-CAL-002**: 日付クリックで該当日の日報を開く
- **FR-CAL-003**: 過去日は実績稼働時間を円ゲージで表示
  - 稼働時間に応じて色分け（8h+:緑、6-8h:青、9h+:赤で警告）
- **FR-CAL-004**: 未来日はグレーアウト表示（計画はその日に立てるため）
- **FR-CAL-005**: 年月選択はデータが存在する範囲のみ選択可能（API `/api/calendar/months` で年月リストを取得）
- **FR-CAL-006**: 選択中のプロジェクトでフィルタリング表示

#### 4.2.2 操作機能
- **FR-CAL-007**: 前月・次月のナビゲーションボタン
- **FR-CAL-008**: 年月プルダウンでの直接選択

### 4.3 タイムラインビュー

#### 4.3.1 表示機能
- **FR-TL-001**: 1日の時間軸表示（縦型タイムライン）
- **FR-TL-002**: 計画（PLAN）と実績（RESULT）の並列表示
  - 計画は薄い色、実績は濃い色で表示
- **FR-TL-003**: プロジェクト別の色分け（左ボーダーで表示）
- **FR-TL-004**: 現在時刻インジケーターの表示
- **FR-TL-005**: 計画・実績の合計時間を横並びで表示
- **FR-TL-006**: 選択中のプロジェクトでフィルタリング表示

#### 4.3.2 操作機能
- **FR-TL-007**: マウスオーバーで編集アイコン表示
- **FR-TL-008**: ドラッグ&ドロップによる時間調整（15分単位でスナップ）
- **FR-TL-009**: 予定のプロジェクト変更（メニューから選択）
- **FR-TL-010**: 予定の削除
- **FR-TL-011**: Googleカレンダーの予定を計画に取り込み（将来拡張）
- **FR-TL-012**: 計画を実績にドラッグでコピー（ゴーストプレビュー表示）
- **FR-TL-013**: Markdown形式での一括編集モード

#### 4.3.3 Duration計算ロジック
タイムラインのスロット表示時間（duration）は、データとして保持せず、レンダリング時に動的に計算する。

**アルゴリズム**:
1. 時刻のみのスロット（`* HH:MM`）は休憩として扱うが、通常のスロットと同様に扱う
2. ドラッグした項目の開始時刻のみ変更
3. 移動後の開始時刻順でソートを行う
4. UIレンダリング時にdurationを動的に計算:
   - スロットの開始時刻と次のスロットの開始時刻の差がduration
   - 最後に終了時刻がなければ、最後のスロットは1時間の枠
   - **ただし、最後が休憩スロット（時刻のみ）の場合はレンダリングしない（タイムラインの終了を意味）**
   - 開始時刻が同一のスロットが2つ以上ある場合は重なることを許容

**プロジェクトフィルタの適用順序**:
1. 全スロットでduration計算を実行
2. その後、選択中のプロジェクトでフィルタを適用して表示

### 4.4 TODOビュー

#### 4.4.1 表示機能
- **FR-TODO-001**: プロジェクト別グルーピング表示（デフォルト）
- **FR-TODO-002**: 上部タブでステータス別フィルタリング（全て/未着手/進行中/完了/保留）
  - 各タブに件数バッジ表示
- **FR-TODO-003**: 期限切れTODOのハイライト表示
- **FR-TODO-004**: 期限切れTODOは翌日に自動持ち越し（アラート表示）
- **FR-TODO-005**: TODO検索機能
- **FR-TODO-006**: 選択中のプロジェクトでフィルタリング表示

#### 4.4.2 操作機能
- **FR-TODO-007**: TODOのステータス変更（チェックボックス操作）
- **FR-TODO-008**: マウスオーバーで編集・削除アイコン表示
- **FR-TODO-009**: インライン編集（テキストエリアで複数行対応）
  - 1行目: タスク名 @期日 !優先度
  - 2行目以降: 詳細説明
- **FR-TODO-010**: プロジェクト変更（メニューから選択）
- **FR-TODO-011**: Markdown形式での一括編集モード

### 4.5 プロジェクト管理

#### 4.5.1 表示機能
- **FR-PJ-001**: プロジェクト一覧表示
  - 小さい色付きバッジ（10px）+ [プロジェクトコード] + プロジェクト名
  - 例: `● [P99] 社内業務`
- **FR-PJ-002**: 残TODO件数のバッジ表示
- **FR-PJ-003**: アクティブプロジェクトのみ表示

#### 4.5.2 操作機能
- **FR-PJ-004**: プロジェクトクリックでトグル選択（複数選択可能）
  - タイムライン、TODO、カレンダーに適用
  - ナビゲーションバーに選択中のプロジェクトをタグ表示
  - 個別解除または一括解除が可能
- **FR-PJ-005**: プロジェクトの追加・編集・削除（設定画面）
- **FR-PJ-006**: プロジェクトコードと色の設定（設定画面）
- **FR-PJ-007**: プロジェクトのカテゴリ設定（設定画面）

### 4.6 ルーチン管理

ルーチン取り込みはヘッダーの「取り込み」ボタンからドロワーで表示

#### 4.6.1 表示機能
- **FR-RT-001**: 曜日別ルーチン一覧表示（月〜日タブ）
- **FR-RT-002**: 随時ルーチン一覧表示（随時タブ）
- **FR-RT-003**: 月次ルーチン一覧表示（月次タブ）
  - 月初タスク / 月末タスクをラベル付きで表示
- **FR-RT-004**: 四半期ルーチン一覧表示（四半期タブ）
  - 対象月をラベル表示（例: [3,6,9,12月]）
- **FR-RT-005**: 年次ルーチン一覧表示（年次タブ）
  - 対象日をラベル表示（例: [11/10]）

#### 4.6.2 操作機能
- **FR-RT-006**: ルーチンの複数選択（チェックボックス）
- **FR-RT-007**: 選択したルーチンの一括取り込み
- **FR-RT-008**: ルーチンの追加・編集・削除（YAMLファイル編集）

#### 4.6.3 取り込みロジック
ルーチンを日報に取り込む際、以下のルールで振り分けを行う：

| ルーチン種別 | 時間有無 | 取り込み先 |
|------------|---------|-----------|
| 曜日別（weekly） | あり | PLAN（タイムライン） |
| 随時（adhoc） | あり | PLAN（タイムライン） |
| 月次（monthly） | なし | TODO |
| 四半期（quarterly） | なし | TODO |
| 年次（yearly） | なし | TODO |

- 時間（`time`）フィールドを持つルーチンはPLAN（タイムライン）に追加
- 時間を持たないルーチンはTODO（ステータス: 未着手）に追加

### 4.7 エディタ機能

#### 4.7.1 ビジュアルモード
- **FR-ED-001**: セクション別のフォーム入力
- **FR-ED-002**: 時刻のタイムピッカー入力
- **FR-ED-003**: プロジェクトコードのドロップダウン選択
- **FR-ED-004**: オートコンプリート機能

#### 4.7.2 テキストモード
- **FR-ED-005**: Markdownテキストの直接編集
- **FR-ED-006**: シンタックスハイライト
- **FR-ED-007**: プレビュー表示
- **FR-ED-008**: テキスト/ビジュアルモードの切り替え

#### 4.7.3 共通機能
- **FR-ED-009**: 自動保存機能
- **FR-ED-010**: 編集履歴（Undo/Redo）
- **FR-ED-011**: バリデーション（時刻形式、プロジェクトコード等）

### 4.8 メタデータ管理

- **FR-META-001**: 脚注形式でのメタデータ記述
- **FR-META-002**: メタデータのJSON形式サポート
- **FR-META-003**: メタデータのUI表示（ツールチップ、バッジ等）
- **FR-META-004**: 対応メタデータ項目:
  - `priority`: 優先度（high/medium/low）
  - `duration`: 予定時間（分）
  - `meeting_url`: 会議URL
  - `related_todo`: 関連TODO ID
  - `tags`: タグ配列

---

## 5. 外部連携要件

### 5.1 Slack連携

#### 5.1.1 日報投稿
- **FR-SL-001**: 指定チャンネルへの日報投稿
- **FR-SL-002**: 投稿フォーマットのカスタマイズ
- **FR-SL-003**: 投稿タイミングの設定（手動/自動）
- **FR-SL-004**: 投稿前のプレビュー機能

#### 5.1.2 TODO連携
- **FR-SL-005**: Slackメッセージからのリマインダー取得
- **FR-SL-006**: スター付きメッセージからのTODO取り込み
- **FR-SL-007**: Slack TODO（ブックマーク）との同期

### 5.2 Git連携

- **FR-GIT-001**: 日報ファイル変更時の自動commit
- **FR-GIT-002**: commitメッセージの自動生成（日付ベース: `YYYY-MM-DD 日報更新`）
- **FR-GIT-003**: 保存ボタン（ヘッダーに配置）
  - 未保存変更がある場合に表示
  - 確認モーダルでCommit/Push/Slack投稿を段階的に選択（Steps UI）
    - Commit: ローカルに保存
    - Push: リモートに反映（Commitも自動実行）
    - Slack: 日報を投稿（Commit/Pushも自動実行）
  - Markdownプレビューで保存内容を確認
- **FR-GIT-004**: 変更差分の表示（ツールチップ）

### 5.3 Googleカレンダー連携

- **FR-GCAL-001**: Googleカレンダーからの予定取得
- **FR-GCAL-002**: カレンダービューへの統合表示
- **FR-GCAL-003**: Googleカレンダー予定のPLANへのインポート
- **FR-GCAL-004**: 複数カレンダーの選択表示
- **FR-GCAL-005**: 双方向同期（将来拡張）

### 5.4 勤怠管理システム連携（拡張機能で実装）

勤怠管理システムは組織ごとに異なるため、ユーザー拡張機能として実装する。

- **FR-ATT-001**: 勤怠APIへのデータ送信
- **FR-ATT-002**: 出勤・退勤時刻の自動算出
- **FR-ATT-003**: 勤務時間の集計・送信
- **FR-ATT-004**: 連携先システムの設定機能

### 5.5 ユーザー拡張機能

TypeScriptによるユーザー拡張機能をサポートし、独自の連携やカスタム処理を実装可能とする。

#### 5.5.1 拡張タイプ
- **FR-EXT-001**: Integration拡張（外部システム連携）
- **FR-EXT-002**: Transformer拡張（データ変換・エクスポート）
- **FR-EXT-003**: Action拡張（カスタムボタン・メニュー）
- **FR-EXT-004**: Hook拡張（ライフサイクルフック）

#### 5.5.2 拡張機能管理
- **FR-EXT-005**: 拡張機能ディレクトリの初期化（CLI）
- **FR-EXT-006**: 拡張機能のビルド・ロード
- **FR-EXT-007**: 拡張機能の有効/無効切り替え
- **FR-EXT-008**: 拡張機能からのUI操作（ツールバー、メニュー）
- **FR-EXT-009**: 拡張機能からの環境変数アクセス
- **FR-EXT-010**: 拡張機能の設定ファイル（integrations.yaml内）

#### 5.5.3 ライフサイクルフック
- **FR-EXT-011**: `onBeforeSave` - 日報保存前処理
- **FR-EXT-012**: `onAfterSave` - 日報保存後処理
- **FR-EXT-013**: `onAfterLoad` - 日報読み込み後処理
- **FR-EXT-014**: `onTodoStatusChange` - TODO状態変更時
- **FR-EXT-015**: `onDateChange` - 日付変更時

---

## 6. API仕様

### 6.1 設計方針

- 日報データはMarkdownファイルとして管理し、フロントエンドでパース・編集
- サーバーサイドはファイルの読み書きと、複数日にまたがる集計処理を担当
- 外部連携（Git commit/push、Slack投稿）は日報保存時のオプションとして実行
- frontmatterに統計情報を保存し、カレンダー集計を高速化

### 6.2 エンドポイント一覧

| メソッド | エンドポイント | 説明 |
|---------|---------------|------|
| GET | `/api/reports/:date` | 日報取得（Markdown + 統計情報） |
| PUT | `/api/reports/:date` | 日報保存（git/slack オプション付き） |
| DELETE | `/api/reports/:date` | 日報削除 |
| GET | `/api/calendar` | カレンダー用集計データ取得 |
| GET | `/api/calendar/months` | 日報が存在する年月リスト取得 |
| GET | `/api/config` | 設定取得（プロジェクト・ルーチン） |
| PUT | `/api/config` | 設定更新 |
| GET | `/api/gcal/events` | Googleカレンダー予定取得 |

### 6.3 日報保存リクエスト

日報保存時に、Git操作とSlack投稿をオプションで指定可能：

```json
PUT /api/reports/2025-12-18
{
  "content": "# [日報] サンプル太郎 2025-12-18\n\n## [PLAN]\n...",
  "git": {
    "commit": true,
    "push": true
  },
  "slack": {
    "post": true
  }
}
```

サーバーは以下の処理を行う：
1. Markdownをパースして統計情報を計算
2. frontmatterを付与してファイルに保存
3. オプションに応じてGit commit/push、Slack投稿を実行

### 6.4 カレンダーAPI

各日報ファイルのfrontmatterから統計情報を読み取り、高速に集計：

```
GET /api/calendar?year=2025&month=12
```

レスポンス：
```json
{
  "year": 2025,
  "month": 12,
  "days": [
    { "date": "2025-12-18", "hasReport": true, "planHours": 8.0, "resultHours": 7.5, "todoCount": 5, "todoCompleted": 2 },
    ...
  ],
  "summary": {
    "totalPlanHours": 160.5,
    "totalResultHours": 155.0,
    "workDays": 20
  }
}
```

---

## 7. 非機能要件

### 7.1 パフォーマンス
- **NFR-PERF-001**: 画面初期表示3秒以内
- **NFR-PERF-002**: 日報ファイルの読み込み1秒以内
- **NFR-PERF-003**: 自動保存によるUI遅延なし

### 7.2 ユーザビリティ
- **NFR-UX-001**: キーボードショートカット対応
- **NFR-UX-002**: レスポンシブデザイン（タブレット対応）
- **NFR-UX-003**: オフライン時のローカル編集対応

### 7.3 信頼性
- **NFR-REL-001**: 編集中データの自動バックアップ
- **NFR-REL-002**: ファイル破損防止（アトミック書き込み）
- **NFR-REL-003**: エラー時のリカバリ機能

### 7.4 セキュリティ
- **NFR-SEC-001**: ローカル環境での動作（外部公開なし）
- **NFR-SEC-002**: 外部API認証情報の安全な管理（.env、環境変数）
- **NFR-SEC-003**: ファイルアクセスの制限（ユーザーデータディレクトリ配下のみ）
- **NFR-SEC-004**: 拡張機能の実行環境の隔離（オプション）

### 7.5 保守性
- **NFR-MAINT-001**: モジュラーなコンポーネント設計
- **NFR-MAINT-002**: TypeScript使用による型安全性
- **NFR-MAINT-003**: ユニットテストのカバレッジ80%以上

---

## 8. 画面設計

### 8.1 メイン画面構成

```
┌────────────────────────────────────────────────────────────────┐
│  Header: ロゴ | 日付選択 | Slack/GCal/Git状態 | 取り込み |       │
│          Commit&Push | ユーザー                                 │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  ┌───────────────┬───────────────┬────────────────────────┐   │
│  │               │               │                        │   │
│  │  タイムライン  │     TODO      │      カレンダー        │   │
│  │  (計画/実績)   │  (PJ別表示)   │       (月表示)         │   │
│  │               │               │  ・過去日:稼働ゲージ   │   │
│  │  ・左:計画    │  ・上部タブで  │  ・未来日:グレー       │   │
│  │  ・右:実績    │   ステータス   │                        │   │
│  │  ・GCal表示   │   フィルタ     ├────────────────────────┤   │
│  │               │               │                        │   │
│  │  ←ドラッグ→  │               │     プロジェクト        │   │
│  │   幅変更可    │               │  ・残TODO件数表示      │   │
│  │               │               │  ・クリックでフィルタ  │   │
│  └───────────────┴───────────────┴────────────────────────┘   │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

※ルーチン取り込みは「取り込み」ボタンからドロワーで表示
※フッターは廃止（情報はヘッダーに集約）

### 8.2 日報編集画面

```
┌────────────────────────────────────────────────────────────────┐
│  日報編集: 2025-12-18            [ビジュアル|テキスト] [保存]  │
├────────────────────────────────────────────────────────────────┤
│                                                                │
│  [PLAN]                                    [ルーチンから適用]  │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 08:30 │ [P99 ▼] │ タスク確認・整理、日報返信   │ [+] [-] │ │
│  │ 09:00 │ [P99 ▼] │ 新人研修サポート             │ [+] [-] │ │
│  │ 09:30 │ [P34 ▼] │ クライアントA MTG           │ [+] [-] │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  [RESULT]                                                      │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ 08:30 │ [P99 ▼] │ タスク確認・整理、日報返信   │ [+] [-] │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
│  [TODO]                                                        │
│  ┌──────────────────────────────────────────────────────────┐ │
│  │ [ ] │ [P99 ▼] │ ブラウザ等アップデート         │ [編集]  │ │
│  │ [*] │ [P99 ▼] │ 社内規定作成                 │ [編集]  │ │
│  └──────────────────────────────────────────────────────────┘ │
│                                                                │
└────────────────────────────────────────────────────────────────┘
```

---

## 9. キーボードショートカット

| ショートカット | 機能 |
|---------------|------|
| `Ctrl/Cmd + S` | 保存 |
| `Ctrl/Cmd + Z` | 元に戻す |
| `Ctrl/Cmd + Shift + Z` | やり直し |
| `Ctrl/Cmd + E` | テキスト/ビジュアルモード切り替え |
| `Ctrl/Cmd + T` | 今日の日報を開く |
| `Ctrl/Cmd + ←/→` | 前日/翌日に移動 |
| `Ctrl/Cmd + N` | 新規TODO追加 |
| `Ctrl/Cmd + P` | 新規予定追加 |
| `Ctrl/Cmd + G` | Git commit |
| `Ctrl/Cmd + Shift + G` | Git push |
| `Ctrl/Cmd + K` | コマンドパレット |

---

## 10. 開発フェーズ

### Phase 1: 基盤構築（2週間）
- プロジェクトセットアップ（Express + React）
- Markdownパーサーの実装
- 基本的なCRUD API
- 日報の基本表示

### Phase 2: コア機能（3週間）
- タイムラインビュー
- TODOビュー
- テキスト/ビジュアルエディタ
- プロジェクト管理

### Phase 3: カレンダー・ルーチン（2週間）
- カレンダービュー（週/月）
- ルーチン管理機能
- ルーチン自動適用

### Phase 4: ダッシュボード（2週間）
- レイアウトカスタマイズ
- ドラッグ&ドロップ
- 設定保存

### Phase 5: 外部連携（3週間）
- Slack連携
- Git連携
- Googleカレンダー連携

### Phase 6: 改善・安定化（2週間）
- パフォーマンス最適化
- テスト追加
- ドキュメント整備

---

## 11. 付録

### 11.1 用語集

| 用語 | 説明 |
|------|------|
| PLAN | 予定（計画） |
| RESULT | 実績 |
| TODO | タスク・やること |
| ルーチン | 定期的に繰り返すタスク |
| プロジェクトコード | プロジェクトを識別する短い記号（例: P99, P34） |
| メタデータ | タスクに付随する追加情報（優先度、時間等） |

### 11.2 参考リンク

- [Ant Design](https://ant.design/)
- [React](https://react.dev/)
- [Express.js](https://expressjs.com/)
- [unified/remark](https://unifiedjs.com/)

---

## 更新履歴

| バージョン | 日付 | 更新内容 | 担当者 |
|-----------|------|---------|--------|
| 1.0 | 2025-12-20 | mdJournalとして公開準備、ドキュメント整備 | - |
| 0.7 | 2025-12-19 | ルーチン機能強化・UI変更 | - |
| 0.6 | 2025-12-19 | CLIツール・カレンダーAPI追加 | - |
| 0.5 | 2025-12-19 | タイムライン・プロジェクト機能を更新 | - |
| 0.4 | 2025-12-18 | TODO/UI仕様を更新 | - |
| 0.3 | 2025-12-18 | API仕様を簡略化（6エンドポイントに集約） |
| 0.2 | 2025-12-18 | モック実装に基づきUI仕様を更新 | - |
| 0.1 | 2025-12-18 | 初版作成 | - |
